<?php

/**
* Implements hook_preprocess_region
*/

function user_welcome_preprocess_page(&$variables)
{
    if ($variables['page']['sidebar_first']) {
        // Invalidate the cache on the user context, so we don't get old login data
        $variables['#cache']['contexts'][] = 'user';
        $user = Drupal\user\Entity\User::load(Drupal::currentUser()->id());
        $content = '';
        if (Drupal::currentUser()->isAuthenticated()) {
            $content  = '<p>Hello ' . $user->get('name')->value . '!<br>';
            $content .= 'Your last log in was ' . date('F jS, Y g:i a', $user->getLastLoginTime()) . '<br>';
            $content .= '<a href="/user/' . $user->id . '">Visit your profile</a>';
        }
        
        $variables['page']['sidebar_first'][]['#markup'] = $content;
    }
}